# Firebase 寫入次數預估

Firebase 計費：每份文件的 `setDoc` / `updateDoc` = **1 write**，`deleteDoc` = **1 write**。

---

## 寫入來源

| 來源 | 路徑 | 觸發條件 | 節流 |
|------|------|----------|------|
| MainView | `users/{uid}/ui/mainView` | 篩選釘選變更（新增/移除釘選、清理無效） | 600ms debounce + 內容相同不寫 |
| App (habits) | `users/{uid}/habits/{itemId}` | 進度/設定變更（+10、+20、計時器、計算機、升級/降級） | **900ms debounce（同一 doc 只寫最後一次）** |
| App (immediate) | 同上 | 新增習慣、編輯習慣儲存 | 無 debounce，每次 1 write |
| App (delete) | 刪除 `habits/{itemId}` | 刪除習慣 | 每次 1 write |

---

## 預估公式（每日）

```
每日寫入 ≈
  [ 篩選變更次數 ]                    → 0 ~ 約 5（多數日子 0~1）
+ [ 有改動的習慣數 × 每習慣合併後寫入 ]  → 每習慣約 1~3 次（debounce 合併）
+ [ 新增習慣數 × 1 ]
+ [ 編輯並儲存次數 × 1 ]
+ [ 刪除習慣數 × 1 ]
```

---

## 情境試算

### 情境 A：輕度使用（只記進度、不改結構）

- 5 個習慣，每個當天改 2～3 次（+10、+20、計時器停、計算機等）
- debounce 後：每習慣約 **1～2 次** 寫入  
- 篩選不變：**0** 寫入 mainView  

**預估：5 × 1.5 ≈ 8 writes/日**  
→ 約 **240 writes/月**

---

### 情境 B：中度使用（偶爾新增/編輯）

- 與 A 相同進度寫入：**~8**
- 當天新增 1 個習慣：**1**（immediate）
- 當天編輯 1 個習慣並儲存：**1**（immediate）
- 篩選變更 1 次：**1**  

**預估：8 + 1 + 1 + 1 ≈ 11 writes/日**  
→ 約 **330 writes/月**

---

### 情境 C：單次大量匯入（Settings 匯入）

- 匯入 30 個項目 → 目前實作每個項目 1 次 `updateItem`  
- **30 writes**（單次操作）

若改為 Firestore `writeBatch`，可將 30 次合併為 **1 batch**（Firebase 仍計為 30 writes，但可減少連線與延遲）。

---

### 情境 D：連續快速點擊（debounce 效果）

- 同一習慣連續點 +10 共 5 次（2 秒內）  
- 無 debounce：5 writes  
- 有 900ms debounce：**1 write**（只寫最後狀態）

---

## 每月預估總表（單一用戶）

| 使用程度 | 習慣數 | 每日進度寫入（debounce 後） | 每日結構變更 | mainView | 每日小計 | 每月約略 |
|----------|--------|-----------------------------|--------------|----------|----------|-----------|
| 輕度 | 5 | ~8 | 0 | 0 | **~8** | **~240** |
| 中度 | 8 | ~12 | 1～2 | 0～1 | **~14** | **~420** |
| 重度 | 12 | ~20 | 2～3 | 1 | **~24** | **~720** |

（結構變更 = 新增 + 編輯儲存 + 刪除）

---

## 總結

- **有 debounce 時**：預估單一用戶約 **每日 8～25 次寫入**、**每月約 240～750 次**，依使用頻率與習慣數量而定。
- **無 debounce 時**：同一操作可能多 2～5 倍寫入（例如連續點 +10、計時器與計算機短時間內多次改動）。
- 若需再壓低：可將 `HABIT_WRITE_DEBOUNCE_MS` 調大（例如 1500～2000ms），或對 Settings 匯入改為 `writeBatch` 以控制單次操作的寫入行為。
